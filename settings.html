<!doctype html>
<html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.0.9/css/all.css" integrity="sha384-5SOiIsAziJl6AWe0HWRKTXlfcSHKmYV4RBF18PPJ173Kzn7jzMyFuTtk8JA7QQG1" crossorigin="anonymous">
    <link rel="stylesheet" href="financeAid.css">
    
    <title>Finance Aid</title>
  </head>
  <body>
    <div class="d-flex">
      <nav class="sidebar bg-dark settingsidebar" id="sidebar">
        <ul class="list-unstyled">
          <li><a class="navbar-brand text-center" href="financeAid.html">Finance Aid</a></li>
          <li>
            <a href="income.html" class="text-center d-block">
                <i class="fa fa-plus nav-item float-left"></i>
                <div class="text">
                  <span class="d-none d-lg-block">Income</span>
                  <span class="d-none d-lg-block" id="totalIncome">RM0.00</span>
                </div>
            </a>
          </li>
          <li>
            <a href="expense.html" class="text-center d-block">
              <i class="fa fa-minus nav-item float-left"></i>
              <span class="d-none d-lg-block">Expense</span>
              <span class="d-none d-lg-block" id="totalExpense">RM0.00</span>                   
            </a>
          </li>
          <li>
            <a href="transfer.html" class="text-center d-block">
              <i class="fa fa-exchange-alt nav-item float-left middleicon"></i>
              <span class="d-none d-lg-inline align-middle">Transfer</span>
            </a>
          </li>
          <hr style="background-color: white;">
          <li>
            <a href="#" class="text-center d-block">
              <i class="fa fa-cog nav-item float-left middleicon"></i>
              <span class="d-none d-lg-inline align-middle">Settings</span>
            </a>
          </li>
        </ul>
      </nav>

      <!--content of page-->
      <div class="content p-1">
        <!--Button to toggle side bar-->
        <ul id="toggle-group" class="p-0">
          <li>
            <a class="sidebar-toggle btn text-light"><i class="fa fa-bars" style="color:white;"></i>Menu</a>
          </li>
        </ul>
        <!-- Header that include balance and setting of starting amount for accounts -->
        <div class="container py-md-2 pt-md-4">
          <div class="row">
            <div class="col-md-2"></div>
            <div class="col-md-4 card-item d-flex align-items-center justify-content-center" align="center">
              <a href="#" class="py-4 px-5 bg-primary" data-toggle="modal" data-target="#cashModal">
                <p>CASH</p>
                <p id="currentCashAmt"></p>
              </a>
            </div>
            <div class="col-md-1"></div>
            <div class="col-md-4 card-item d-flex align-items-center justify-content-center" align="center">
                <a href="#" class="py-4 px-5 bg-primary" data-toggle="modal" data-target="#bankModal">
                  <p>BANK</p>
                  <p id="currentBankAmt"></p>
                </a>
            </div>
          </div>
        </div>
      
        <!-- Modal for cash -->
        <div id="cashModal" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="cashModalCenterTitle" aria-hidden="true">
          <div class="modal-dialog modal-dialog-centered" role="document">
            <div class="modal-content">
              <div class="modal-header">
                <h5 class="modal-title" id="cashModalCenterTitle">Set starting amount of Cash</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close" id="cashCloseBtn">
                  <span aria-hidden="true">&times;</span>
                </button>
              </div>
              <div class="modal-body">
                <form>
                <div class="form-group">
                  <label for="startCash">RM *</label>
                  <input type="text" class="form-control" id="cashStartAmt" placeholder="Amount" aria-label="startCashAmount" aria-describedby="basic-addon1" name="startCash" maxlength="10">
                </div>
                </form>
              </div>
              <div class="modal-footer">
                <button type="button" class="saveCash btn btn-primary" data-dismiss="modal">Save</button>
              </div>
            </div>
          </div>
        </div>
      
        <!-- Modal for bank -->
        <div id="bankModal" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="bankModalCenterTitle" aria-hidden="true">
          <div class="modal-dialog modal-dialog-centered" role="document">
            <div class="modal-content">
              <div class="modal-header">
                <h5 class="modal-title" id="bankModalCenterTitle">Set starting amount of Bank</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close" id="bankCloseBtn">
                  <span aria-hidden="true">&times;</span>
                </button>
              </div>
              <div class="modal-body">
                <form>
                <div class="form-group">
                  <label for="startBank">RM *</label>
                  <input type="text" class="form-control" id="bankStartAmt" placeholder="Amount" aria-label="startBankAmount" aria-describedby="basic-addon1" name="startBank" maxlength="10">
                </div>
                </form>
              </div>
              <div class="modal-footer">
                <button type="button" class="saveBank btn btn-primary" data-dismiss="modal">Save</button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    

    <!-- Optional JavaScript -->
    <!-- jQuery first, then Popper.js, then Bootstrap JS -->
    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>
    <script src="https://www.gstatic.com/firebasejs/4.12.0/firebase.js"></script>
    <script src="https://www.gstatic.com/firebasejs/4.12.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/4.12.0/firebase-database.js"></script>
    <script src="financeAid.js"></script>
    <script>
      // Initialize Firebase
      var config = {
        apiKey: "AIzaSyAR3t7qI2D5wRu4fO38FuPYbPegZwQd_yI",
        authDomain: "finance-aid-b7793.firebaseapp.com",
        databaseURL: "https://finance-aid-b7793.firebaseio.com",
        projectId: "finance-aid-b7793",
        storageBucket: "finance-aid-b7793.appspot.com",
        messagingSenderId: "165519709635"
      };
      firebase.initializeApp(config);

      //only enable number and decimal points to be input
      $('#cashStartAmt').keypress(function(e) {
        var a = [];
        var k = e.which;

        var y = 46;
        a.push(y);

        for (i = 48; i < 58; i++)
          a.push(i);
    
        if (!(a.indexOf(k)>=0))
          e.preventDefault();    
      });

      $('#bankStartAmt').keypress(function(e) {
        var a = [];
        var k = e.which;

        var y = 46;
        a.push(y);

        for (i = 48; i < 58; i++)
          a.push(i);
    
        if (!(a.indexOf(k)>=0))
          e.preventDefault();    
      });

      //Write amount input by user to firebase database      
      var startCashAmt = {};
      var startCashKey;
      var currentCashAmt = {};
      var currentCashKey;

      var startBankAmt = {};
      var startBankKey;
      var currentBankAmt = {};
      var currentBankKey;

      //saving cash from input
      $('.saveCash').on('click', function(e) {
        e.preventDefault();
        var validCashAmt = document.getElementById("cashStartAmt").value;
        if (validCashAmt != null && parseFloat(validCashAmt) > 0){
          startCashKey = startCashKey ? startCashKey : firebase.database().ref().child('startCash').push().key;
          startCashAmt.startCash = document.getElementById("cashStartAmt").value;
          firebase.database().ref().child('startCash').set(startCashAmt);
          currentCashAmt = {currentCash: startCashAmt.startCash};
          currefntCashKey = currentCashKey ? currentCashKey : firebase.database().ref().child('currentCashAmt').push().key;
          firebase.database().ref().child('currentCashAmt').set(currentCashAmt);
          document.getElementById("cashStartAmt").value = '';
        } else {
          alert('Please fill up the starting amount');
          document.getElementById("cashStartAmt").value = '';
        }        
      });

      //saving bank from input
      $('.saveBank').on('click', function(e) {
        e.preventDefault();
        var validBankAmt = document.getElementById("bankStartAmt").value;
        if (validBankAmt != null && parseFloat(validBankAmt) > 0){
          startBankKey = startBankKey ? startBankKey : firebase.database().ref().child('startBank').push().key;
          startBankAmt.startBank = document.getElementById("bankStartAmt").value;
          firebase.database().ref().child('startBank').set(startBankAmt);
          currentBankAmt = {currentBank: startBankAmt.startBank};
          currentBankKey = currentBankKey ? currentBankKey : firebase.database().ref().child('currentBankAmt').push().key;
          firebase.database().ref().child('currentBankAmt').set(currentBankAmt);
          document.getElementById("bankStartAmt").value = '';
        } else {
          alert('Please fill up the starting amount');
          document.getElementById("bankStartAmt").value = '';
        }        
      });

      //Read current cash from database
      var amountCashRef = firebase.database().ref('currentCashAmt');
      var dispCurrentCash;
      amountCashRef.on('value', function(snapshot){
          var childData = snapshot.val();
          dispCurrentCash = parseFloat(childData.currentCash).toFixed(2);
          
          document.getElementById("dispCurrentCash").value = "RM" + dispCurrentCash;
      });

      //Read current bank from database
      var amountBankRef = firebase.database().ref('currentBankAmt');
      var dispCurrentBank;
      amountBankRef.on('value', function(snapshot){
          var childData = snapshot.val();
          dispCurrentBank = parseFloat(childData.currentBank).toFixed(2);
          
          document.getElementById("dispCurrentBank").value = "RM" + dispCurrentBank;
      });

      //Read the total amount of income from database
      var totalIncomeRef = firebase.database().ref('incomeObj');
      var totalIncomeObj;
      var totalIncome = 0;
      totalIncomeRef.on('value', function(snapshot){
        snapshot.forEach(function(childSnapshot){
          totalIncomeObj = childSnapshot.val();
          var incAmt = parseFloat(totalIncomeObj.incomeAmount);
          totalIncome += incAmt;
        });
        document.getElementById("totalIncome").innerHTML = "RM" + totalIncome.toFixed(2);
      });

      //Read the total amount of expense from database
      var totalExpenseRef = firebase.database().ref('expenseObj');
      var totalExpenseObj;
      var totalExpense = 0;
      totalExpenseRef.on('value', function(snapshot){
        snapshot.forEach(function(childSnapshot){
          totalExpenseObj = childSnapshot.val();
          var expAmt = parseFloat(totalExpenseObj.expenseAmount);
          totalExpense += expAmt;
        });
        document.getElementById("totalExpense").innerHTML = "RM" + totalExpense.toFixed(2);
      });
    </script>
  </body>
</html>