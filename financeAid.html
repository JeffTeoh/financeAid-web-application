<!doctype html>
<html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.0.9/css/all.css" integrity="sha384-5SOiIsAziJl6AWe0HWRKTXlfcSHKmYV4RBF18PPJ173Kzn7jzMyFuTtk8JA7QQG1" crossorigin="anonymous">
    <link rel="stylesheet" href="https://code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
    <link rel="stylesheet" href="financeAid.css">
    
    <title>Finance Aid</title>
  </head>
  <body>
    <div class="d-flex">
      <nav class="sidebar bg-dark">
        <ul class="list-unstyled">
          <li><a class="navbar-brand text-center" href="#">Finance Aid</a></li>
          <li>
            <a href="income.html">
              <div class="container">
                <div class="row">
                  <div class="col-lg-2">
                    <i class="fa fa-plus"></i>
                  </div>
                  <div class="col-lg-10">
                    Income
                  </div>
                </div>
              </div>              
            </a>
          </li>
          <li>
            <a href="expense.html">
              <div class="container">
                <div class="row">
                  <div class="col-lg-2">
                    <i class="fa fa-minus"></i>
                  </div>
                  <div class="col-lg-10">
                    Expense
                  </div>
                </div>
              </div>               
            </a>
          </li>
          <li>
            <a href="transfer.html">
              <div class="container">
                <div class="row">
                  <div class="col-lg-2">
                    <i class="fa fa-exchange-alt"></i>
                  </div>
                  <div class="col-lg-10">
                    Transfer
                  </div>
                </div>
              </div>               
            </a>
          </li>
          <hr style="background-color: white;">
          <li>
            <a href="settings.html">
              <div class="container">
                <div class="row">
                  <div class="col-lg-2">
                    <i class="fa fa-cog"></i>
                  </div>
                  <div class="col-lg-10">
                    Settings
                  </div>
                </div>
              </div>               
            </a>
          </li>
        </ul>
      </nav>
      
      <!-- Content in middle of web page --> 
      <div class="content p-4">
        <a class="sidebar-toggle text-light mr-3"><i class="fa fa-bars" style="color:blue; background-cokir: #4c4c4c"></i></a>
        <!-- Header that include balance and setting of starting amount for accounts -->
        <div class="container py-md-2 pt-md-4">
          <div class="row">
            <div class="col-md-2 text-center">
              <p style="font-size:2rem;">Balance:</p>
            </div>
            <div class="col-md-1"></div>
            <div class="col-md-4 text-center">
              <form>
                <label for="dispCurrentCash">Cash</label>
                <input class="form-control" id="dispCurrentCash" value="RM0.00" readonly>
              </form>
            </div>
            <div class="col-md-4 text-center">
              <form>
                <label for="dispCurrentBank">Bank</label>
                <input class="form-control" id="dispCurrentBank" value="RM0.00" readonly>
              </form>
            </div>  
          </div>
        </div>
              
        <div class="container menu-items">
          <div class="row">
            <div class="col-lg-1"></div>
            <div class="col-lg-3 col-sm-12">
              <div class="dropdown d-flex align-items-center justify-content-center link" align="center">
                <button class="btn btn-primary px-5 py-3 dropdown-toggle " type="button" id="dropdownMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                  Summary
                </button>
                <div class="dropdown-menu dropdown-menu-wide" aria-labelledby="dropdownMenuButton">
                  <a class="dropdown-item" href="sumByMonth.html">By Month</a>
                  <a class="dropdown-item" href="sumByType.html">By Type</a>
                </div>
              </div>
            </div>
            <div class="col-lg-2"></div>
          </div>
        </div>
      </div>

      <!-- Content of right side bar -->
      <div class="sidebar-right">
        <div class="summary text-center mt-4 mx-0">
          <div class="btn-group btn-group-toggle" data-toggle="buttons">
            <button class="btn btn-secondary active" id="sumByDate">
              <input type="radio" name="options" id="option1" autocomplete="off" checked>
                <i class="fa fa-calendar-alt"></i>
                By date
            </button>
            <button class="btn btn-secondary" id="sumByCat">
              <input type="radio" name="options" id="option2" autocomplete="off">
                <i class="fa fa-tag"></i>
                By category
            </button>
          </div>
        </div>

        <ul class="list-group" id="expenseList">
          <!--Insert from database-->                           
        </ul>

        <!--Button for adding records-->
        <button class="btn bg-dark" type="button" data-toggle="modal" data-target="#addRecord" id="addRecordBtn">
          <i class="fa fa-plus p-3" style="color: white; font-size: 50px;"></i>
        </button>

        <!-- Modal for adding records -->
        <div class="modal fade" id="addRecord" tabindex="-1" role="dialog" aria-labelledby="addRecord" aria-hidden="true">
          <div class="modal-dialog modal-dialog-centered" role="document">
            <div class="modal-content">
              <div class="modal-header">
                <select class="custom-select" id="selectFeature">
                  <option value="exp" selected="selected">Add Expense</option>
                  <option value="inc">Add Income</option>
                  <option value="trf">Add Transfer</option>
                </select>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close" id="closeBtn">
                  <span aria-hidden="true">&#10005;</span>
                </button>
              </div>
              <div class="modal-body" id="modal-body">
                <div id="amount-group">
                  <label for="amount">Amount</label>
                  <div class="input-group mb-3">
                    <input onkeyup="checkFormsValidity();" type="text" class="form-control" id="amount" placeholder="Amount" aria-label="amount" aria-describedby="amount" required="required">
                    <div class="input-group-append">
                      <span class="input-group-text">RM</span>
                    </div>
                  </div>
                </div>
                <div id="account-group">
                  <label for="account">Account</label>
                  <div class="input-group mb-3">
                    <select name="" id="account">
                      <option value="">Choose an option:</option>
                      <option value="Bank">Bank</option>
                      <option value="Cash">Cash</option>
                    </select>
                  </div>
                </div>
                <div id="category-group">
                  <label for="category">Category</label>
                  <div class="input-group mb-3">
                    <select name="" id="category">
                      <option value="">Choose an option:</option>
                      <option value="Foods and Drinks">Foods and Drinks</option>
                      <option value="Vehicle">Vehicle</option>
                      <option value="Entertainment">Entertainment</option>                                
                    </select>
                  </div>
                </div>                
                <div id="trfFrom-group">
                  <label for="transferFrom">Transfer From</label>
                  <div class="input-group mb-3">
                    <select name="" id="transferFrom">
                      <option value="" selected="selected">Choose an option:</option>
                      <option value="Bank">Bank</option>
                      <option value="Cash">Cash</option>
                    </select>
                  </div>
                </div>
                <div id="trfTo-group">
                  <label for="transferTo">Transfer To</label>
                  <div class="input-group mb-3">
                    <input class="form-control" id="transferTo" readonly>
                  </div>                  
                </div>
                <div id="date-group">
                  <label for="date">Date</label>
                  <div class="input-group mb-3">
                    <input type="text" class="datepicker" id="datepicker"></p>
                  </div>
                </div>
                <button type="button" data-dismiss="modal" class="btn btn-secondary btn-lg btn-block" id="saveBtn">Save</button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Optional JavaScript -->
    <!-- jQuery first, then Popper.js, then Bootstrap JS -->
    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>
    <script src="https://code.jquery.com/jquery-1.12.4.js"></script>
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
    <script src="https://www.gstatic.com/firebasejs/4.12.0/firebase.js"></script>
    <script src="https://www.gstatic.com/firebasejs/4.12.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/4.12.0/firebase-database.js"></script>
    <script src="financeAid.js"></script>
    <script>
      //Initialise Datepicker
      $('.datepicker').datepicker({ maxDate: new Date() }).datepicker("setDate", new Date());
      
      // Initialize Firebase
      var config = {
        apiKey: "AIzaSyAR3t7qI2D5wRu4fO38FuPYbPegZwQd_yI",
        authDomain: "finance-aid-b7793.firebaseapp.com",
        databaseURL: "https://finance-aid-b7793.firebaseio.com",
        projectId: "finance-aid-b7793",
        storageBucket: "finance-aid-b7793.appspot.com",
        messagingSenderId: "165519709635"
      };
      firebase.initializeApp(config);

      //Read current cash from database
      var amountCashRef = firebase.database().ref('currentCashAmt');
      var dispCurrentCash;
      amountCashRef.on('value', function(snapshot){
          var childData = snapshot.val();
          dispCurrentCash = parseFloat(childData.currentCash).toFixed(2);
          
          document.getElementById("dispCurrentCash").value = "RM" + dispCurrentCash;
      });

      //Read current bank from database
      var amountBankRef = firebase.database().ref('currentBankAmt');
      var dispCurrentBank;
      amountBankRef.on('value', function(snapshot){
          var childData = snapshot.val();
          dispCurrentBank = parseFloat(childData.currentBank).toFixed(2);
          
          document.getElementById("dispCurrentBank").value = "RM" + dispCurrentBank;
      });

      //output list of data when loading the page and only appear if there are available data
      var expenseRef = firebase.database().ref('expenseObj').orderByChild('expenseDate');
      var expenseObj;
      expenseRef.on("value", function(snapshot) {
        snapshot.forEach(function(childSnapshot){
          expenseObj = childSnapshot.val();
          var expDate = expenseObj.expenseDate;
          var expAcc = expenseObj.expenseAccount;
          var expCat = expenseObj.expenseCategory;
          var expAmt = parseFloat(expenseObj.expenseAmount);
          //console.log(expDate);
          //console.log(expAcc);
          //console.log(expAmt);
          $('#expenseList').append(
          '<li class="list-group-item nopadding">' + 
            '<div class="card">' + 
              '<div class="card-header">' + expDate + '</div>' + 
              '<div class="card-body" href="#">' +
                '<div class="card-text">' + 
                  '<p>' + expAcc + '</p>' + 
                  '<p>' + expCat + '</p>' + 
                  '<p>' + "RM" + expAmt.toFixed(2) + '</p>' +
                '</div>' +
              '</div>' +
            '</div>' +
          '</li>');
        });
      });

      //display expense records with filter
      $('#sumByDate').click(function(){
        $('#expenseList li').remove();
        var expenseRef = firebase.database().ref('expenseObj').orderByChild('expenseDate');
        var expenseObj;
        expenseRef.on("value", function(snapshot) {
          snapshot.forEach(function(childSnapshot){
            expenseObj = childSnapshot.val();
            var expDate = expenseObj.expenseDate;
            var expAcc = expenseObj.expenseAccount;
            var expCat = expenseObj.expenseCategory;
            var expAmt = parseFloat(expenseObj.expenseAmount);
            //console.log(expDate);
            //console.log(expAcc);
            //console.log(expAmt);
            $('#expenseList').append(
            '<li class="list-group-item nopadding">' + 
              '<div class="card">' + 
                '<div class="card-header">' + expDate + '</div>' + 
                '<div class="card-body" href="#">' +
                  '<div class="card-text">' + 
                    '<p>' + expAcc + '</p>' + 
                    '<p>' + expCat + '</p>' + 
                    '<p>' + "RM" + expAmt.toFixed(2) + '</p>' +
                  '</div>' +
                '</div>' +
              '</div>' +
            '</li>');
          });
        });
      });
      $('#sumByCat').click(function(){
        $('#expenseList li').remove();
        var expenseRef = firebase.database().ref('expenseObj').orderByChild('expenseCategory');
        var expenseObj;
        expenseRef.on("value", function(snapshot) {
          snapshot.forEach(function(childSnapshot){
            expenseObj = childSnapshot.val();
            var expDate = expenseObj.expenseDate;
            var expAcc = expenseObj.expenseAccount;
            var expCat = expenseObj.expenseCategory;
            var expAmt = parseFloat(expenseObj.expenseAmount);
            //console.log(expDate);
            //console.log(expAcc);
            //console.log(expAmt);
            $('#expenseList').append(
            '<li class="list-group-item nopadding">' + 
              '<div class="card">' + 
                '<div class="card-header">' + expCat + '</div>' + 
                '<div class="card-body" href="#">' +
                  '<div class="card-text">' + 
                    '<p>' + expDate + '</p>' + 
                    '<p>' + expAcc + '</p>' + 
                    '<p>' + "RM" + expAmt.toFixed(2) + '</p>' +
                  '</div>' +
                '</div>' +
              '</div>' +
            '</li>');
          });
        });
      });

      // Disable function
      jQuery.fn.extend({
        disable: function(state) {
          return this.each(function() {
            this.disabled = state;
          });
        }
      });

      //change disabled state if the input area are filled
      var saveButton = document.getElementById('saveBtn');
      saveButton.disabled = true;

      function checkFormsValidity(){
        var amountInput = document.getElementById('amount');
        if (amountInput.checkValidity()) {
          saveButton.disabled = false;
        } else {
          saveButton.disabled = true;
        }
      }

      //only enable number and decimal points to be input
      $('#amount').keypress(function(e) {
        var a = [];
        var k = e.which;

        var y = 46;
        a.push(y);

        for (i = 48; i < 58; i++)
          a.push(i);
    
        if (!(a.indexOf(k)>=0))
          e.preventDefault();    
      });

      //auto set transfer account when user selected
      var selectedAccount = $("#transferFrom option:selected");
      $('#transferFrom').change(function(){
        selectedAccount.each(function() {
          if (document.getElementById("transferFrom").value == "Bank"){
            document.getElementById("transferTo").value = "Cash";
          } else if (document.getElementById("transferFrom").value == "Cash"){
            document.getElementById("transferTo").value = "Bank";
          } else {
            document.getElementById("transferTo").value = "";
          }
        });
      });

      //switch modal body view by selection
      $("#selectFeature").change(function(){
        var selectedFeature = this.value;        
        if (selectedFeature == "inc") {
          $("#account-group").show(500);
          $("#category-group").hide(500);
          $("#trfFrom-group").hide(500);          
          $("#trfTo-group").hide(500);
        } else
        if (selectedFeature == "trf") {
          $("#account-group").hide(500);
          $("#category-group").hide(500);
          $("#trfFrom-group").show(500);          
          $("#trfTo-group").show(500);
        } else
        if (selectedFeature == "exp") {
          $("#account-group").show(500);
          $("#category-group").show(500);
          $("#trfFrom-group").hide(500);          
          $("#trfTo-group").hide(500);
        }
      });
      

    </script>
  </body>
</html>